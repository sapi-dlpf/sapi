TODO - Lista de pendências do projeto SAPI
============================================

Problemas para resolver por versão:

1.8) Falhas relatadas pelos últimos usuários.
---------------------------------------------
+/- Possibilidade de correção na estrutura de itens já processada.
- Problema de congelamento do sapi_iped
- Tolerância a falha em caso de não resposta do SETEC3 (travamento do sapi_iped)
- Novo servidor de deployment


1.9) Novas funcionalidades:
---------------------------------------------
- Tratamento completo para inexiquibilidade.
- Mais de uma versão do IPED
- sapi_watchdog
- sapi_imagem: Exame de celular completo, incluindo cartão de memória e pequenos dispositivos de mídia (pendrives) que possam estar
  acompanhando a solicitação.
- Mecanismo para interromper uma tarefa em excução:
  - No servidor, possibilidade de mandar Abortar a tarefa
  - Nos clientes, quando for atualizar status e receber comando de abortar, interromper a execução.

2.0) Tratamento para mídias de massa
---------------------------------------------
- sapi_tableau

2.1) ISO
---------
- Geração automática de ISO para mídia
- Atualização no SETEC3 mídia anexa.
- Consulta no SETEC3 para usuário baixar mídia (talvez...)

3.0) Regime de produção
---------------------------------------------
- Caracteres semi-graficos nos programas interativos
- Arquivamento (ver detalhes abaixo).

4.0) Ampliação de base de usuários
---------------------------------------------
- Módulo de configuração.


=======================================================================================================================
Por programa/componente:
=======================================================================================================================

sapi_lib
* Nas requisições http, tratar ausência de resposta (timeout e retentativas)
- Na conexão com o storage, tratar senha diferenciada (hash)

sapi_cellebrite:
  *OK Tolerância a falha na atualização do status
  *OK Tratamento adequado no caso de não conseguir modificar o status
  *OK Log significativo.
  *OK Comando EX, que exclui tarefa.
  - Parsing de campos: pegar todos os modelos, selecionado pelo usuário, detectado, se houver mais do que um.
  - Permitir que o usuário descreva a inexquilidade (Lista com as mais comuns), que será atualizada no servidor.
  - Problema de cópia de relatório gigante do Fernando que deu erro (HD externo)

sapi_iped_executar_bat:
- Está gerando ano_dia_mes.log (revisar....)

sapi_iped
1) Novo servidor de deployment
Bug:
* Está invocando perfil setecpr_ocr ou ocr, revisar, testar
Novos conceitos:
* Refactor: Utilizar paradigma do sapi_cellebrite
* Mudar estrutura de log: geral (do programa) e por tarefa (assim que a tarefa é definida)
* Quando uma tarefa for devolvida (volta para estado AguardandoProcessamento),
  tem que excluir pasta antes...para ficar na situação original.
  Se não for possível excluir a pasta, o estado tem que ficar como abortada
  O ideal é primeiro colocar no estado abortada, e depois passar para o estado de AguardandoProcessamento.
  Desta forma, fica bem registrado que houve um problema.
* Revisar todas as chamadas para sapi_srv_chamar_programa:
  - Parâmetros nominados
  - abortar_insucesso=False
* Rotina para atualizar_status, que se der erro, não tem problema....
  (talvez levar do sapi_cellebrite para o sapilib...vai ser utilizada em outros lugares)
  Levar também a de troca de status.
  - Mas no caso do sapi_iped, se não conseguir trocar situação irá ficar tentando, até conseguir, em loop.
* Receber comando do servidor Web de exclusão.
  - Utilizar o mesmo paradigma dos agentes com interface, ou seja, fica lendo um comando que será passado
    (ao invés de passar o comando pela linha de comando, vem via http)
* Exclusão de tarefa parada:
  - Neste caso será uma tarefa para ser executada, com o comando previamente setado.
  - Ou seja, começa executando a tarefa, verifica que o comando é de exclusão e faz o que tem que fazer.
* Na mensagem do hash, está aparecendo o texto listaArquivos.csv, quando deveria ser "Lista de Arquivos.csv" (Dante)
* Quando for montar multicase, desprezar pastas que não possuam conteúdo (acho que já faz isto...)
* Receber comando de exclusão de tarefa.
  - No servidor, quando mandar excluir tarefa, irá mudar para status (Aguardando execução), e o tipo será 'excluir'.
  - Exclui pasta, e refaz o multicase.
* Utilar sapilib com tratamento de timeout e retentativas para aumentar tolerância a falha
  - Simular tratavadas...colocar resposta para dormir no servidor, com aleatoriedade, forçando retentativas...
* Atualização de status intermediários, se não tiverem sucesso, tudo bem, tenta algumas vezes e desiste.
* Atualização de status final, se não tiver sucesso após algumas tentativas, coloca tarefa como abortada (para ser retomada adiante)
  e prossegue para a próxima.
- Permitir executar mais de uma versão do IPED.
- Quando terminar a execução de uma tarefa, fazer o upload do log da tarefa (teria utilidade?)
- Nao processar o UFDR e o XML: Mover poara outra pasta, e depois retornar novamente para a pasta original
  O XML podia até elmininar no destino, para não ocupar espaço.

sapi_watchdog (NOVO)
- Novo programa, que ficará monitorando se pasta de arquivo de log está sendo modificidado.
- Parâmetros:
  - pasta a ser monitorada:
  - tempo de espera:
  - acao=restart servidor
- Pode ter até mais de um watchdog rodando. Um pode por exemplo mandar email, etc, e outro pode restart o servidor.
- sapi_watchdog não pode usar sapilib, para evitar "se congelar" pelo mesmo motivo que os outros programas...tem que ser leve.

sapi_imagem (NOVO):
  - Funcionalidade de submeter uma imagem a processamento
  - Reconhece formato do guymager (log)
  - Reconhece formato do tableu (log)
  - Reconhece outros formatos sem log, mas neste caso não recupera nenhum dado para laudo:
     - E01 genérico
     - DD genérico
     - Outros formatos raw (qualquer arquivo):
       - Neste caso, ajusta para nomenclatura do IPED (apenas algumas extensões são aceitas...testar)
       - Se tiver vários arquivos que formam um conjunto, tem que dar algum tratamento.


sapi_laudo:
  - converter para sapilib0.8
  - Criar sapicli, que irá agrupar todas as funções comumente utilizadas pelos clientes sapi.
  - Ajustar interface com novos comandos.
  - MSISDN: Quando não existir, já preencher como 'INDISPONÍVEL'
  - Preencher com descrição de inexequibilidade.


sapi_tableau (NOVO):
  - Primeiro fazer o parser no sapi_imagem, para ter uma solução razoável para o pessoal ir utilizando.
  - Controlar interface web


DEPLOYMENT
==========================================================================
Deployment:
  - Montar esquema de deployment no macsetec3
  - No servidor de deployment, a credencial de acesso (login/senha) não pode ser igual à do servidor,
    caso contrário o servidor se loga sozinho...é melhor controlar este acesso, utilizando uma conta diferente.
    deployment_admin
    deployment_consulta
  - Roteiro do servidor de deployment no wiki
  - No desevolvimento, ajustar servidor de deployment para macsetec2.
  - O endereço do servidor de deployment deve ficar no conf, assim cada máquina tem o deployment independente.
  - Para permitir deployment individual de cada programa, fazer configuração individual no setec3.
    sapi_cellebrite.config.php
    sapi_laudo.config.php
    (etc)
    - Armazenar versão e outros dados úteis...talvez através de constantes simbólicas
  - Pasta de download, que armazena versões antigas.


SETEC3
=====================
conf.inc
- Trocar referências a DNS por ip fixo (diminui a chance de problema quando temos problema de DNS).

SETEC3 ????.php
 * Quando uma mensagem de log for inserida, efetuar a exclusão de mensagens irrelevantes (ver script),
  para manter log enxuto.

SETEC3 sapi_painel_administracao.php
- Novo resumo usuário x Situação
- Resumo Tipo x Situação trocar por Situação x Tipo
- Tarefas por período.

SETEC3 sapi_tarefa:
  * Para tarefa de extração:
    - Não permitir Excluir, Reiniciar, Abortar...tudo isto será executado agora apenas pelo sapi_cellebrite
    - Colocar texto esclarecendo isto.
  * Para tarefa de IPED:
    - Permitir excluir, que tem que ser capaz de
      - Parar execução se ainda estiver executando e excluir pasta
      - Excluir pasta de uma execução já concluída, e corrigir o multicase, para não sobrar rastro da tarefa
        (utilizar tipo 'excluir'...??? ou reprocessar normalmente?...talvez seja melhor)

SETEC3 sapi_exame.php:
* Tratar ; ou , no final do item. Está aparecendo item nulo na tela de itens.
- Botão [Gerar], deixar mais claro que também serve para fazer ajustes em tarefas que já foram geradas
  (exemplo: mídia de entrega)
  - Permitir mais de uma versão de IPED, para poder colocar uma versão "Homologada" e outras "novas"
- Quadro para orientar a confecção do laudo:
  - Explicar procedimento (Cadastar laudo, gerar modelo, invocar sapi_laudo.py)
  - Botão para Cadastrar Laudo
  - Botão para gerar modelo do Laudo (Talvez já deixar amarrado aqui o código dos laudos do SAPI....boa)

Modelos:
* Ajustar MJSP para todos (revisar geral)
- Separar modelo de mídia óptica de BLURAY e DVD
- Etiqueta p/ RIMAGE P/ DVD: Colocar DVD na direita (como o bluray)
- Quantidade de páginas, está ficando fixo depois que processa pelo sapi_laudo.py. Pesquisar....


mídia anexa:
  - Reativar mídia anexa para permitir upload de dados gravados.
    - Limpar base. Salvar dump da base de dados antes de limpar, caso no futuro surja alguma dúvida.
  - Permitir upload por programa, para que os isos produzidos no sapi possam ser copiados para o sistema mídia anexa.


MÁQUINAS DE EXAME
===================================================
Máquinas do Cellebrite:
- Instalar libreoffice
- Instalar VNC viewer
- No email, informar que é possível executar todas as tarefas lá...


STORAGES
===================================================
GTPI-STO-01:
  - Promover o GTPI-STO-01 em produtivo.
  - Colocar

GTPI-STO-02:
  - Colocar o GTPI-STO-02 em desenvolvimento novamente.
  - Ajustar deployment para desenvolvimento
  - Deixar rodando

GTPI-STO-03:
  - Reinstalar windows via pendrive. A reinstalação normal não funcionou.


NOVAS FUNCIONALIDADES:
=======================================================================
Arquivamento:
- Limpara pastas de processamento (precisará de um programa específico) que rodará quando:
  - O memorando tiver sido arquivado a mais de 10 dias.
  - O laudo foi entregue e existe confirmação de recebimento.
  - A máquina está ociosa.
  - Em período noturno.

Geração de ISO:
- Armazenar e mostrar o tamanho de cada pasta.
- Permitir a seleção de itens, mostrando o tamanho de cada conjunto (para verificar se cabe na mídia de destino).
- Geração de uma ou mais mídias para cada memorando (tarefas distintas).
- Upload da mídia gerada para o servidor de mídia anexa.


